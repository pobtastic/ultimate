<!DOCTYPE html>
<html>
<head>
<title>Sabre Wulf: Routine at 40257</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="40227.html">40227</a>
</td>
<td class="up">Up: <a href="../maps/all.html#40257">Map</a></td>
<td class="next">
Next: <a href="40337.html">40337</a>
</td>
</tr>
</table>
<div class="description">40257: Routine at 9D41</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="43757.html">43757</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="40257"></span>
<div class="comments">
<div class="paragraph">
Each block of amulet data is 11 bytes long.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="40257"></span>40257</td>
<td class="instruction">LD DE,11</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0011.</td>
</tr>
<tr>
<td class="address-1"><span id="40260"></span>40260</td>
<td class="instruction">LD HL,38910</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="38910.html">AmuletData</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="40263"></span>
<div class="comments">
<div class="paragraph">
There are four pieces of the amulet.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="40263"></span>40263</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=4.</td>
</tr>
<tr>
<td class="address-2"><span id="40265"></span>40265</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="40266"></span>40266</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40267"></span>40267</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40268"></span>40268</td>
<td class="instruction">JR Z,<a href="40257.html#40294">40294</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40270"></span>40270</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40271"></span>40271</td>
<td class="instruction">AND %00001111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-3.</td>
</tr>
<tr>
<td class="address-1"><span id="40273"></span>40273</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Store the result in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="address-1"><span id="40274"></span>40274</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">IX</span>+1 (current location).</td>
</tr>
<tr>
<td class="address-1"><span id="40277"></span>40277</td>
<td class="instruction">AND %00001111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-3.</td>
</tr>
<tr>
<td class="address-1"><span id="40279"></span>40279</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40280"></span>40280</td>
<td class="instruction">JR Z,<a href="40257.html#40299">40299</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="40282"></span>40282</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40283"></span>40283</td>
<td class="instruction">AND %11110000</td>
<td class="comment-1" rowspan="1">Keep only bits 4-7.</td>
</tr>
<tr>
<td class="address-1"><span id="40285"></span>40285</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40286"></span>40286</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40289"></span>40289</td>
<td class="instruction">AND %11110000</td>
<td class="comment-1" rowspan="1">Keep only bits 4-7.</td>
</tr>
<tr>
<td class="address-1"><span id="40291"></span>40291</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40292"></span>40292</td>
<td class="instruction">JR Z,<a href="40257.html#40317">40317</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="40294"></span>40294</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40295"></span>40295</td>
<td class="instruction">DJNZ <a href="40257.html#40265">40265</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40297"></span>40297</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40298"></span>40298</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="40299"></span>40299</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Increment <span class="register">HL</span> by two.</td>
</tr>
<tr>
<td class="address-1"><span id="40300"></span>40300</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="40301"></span>40301</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40302"></span>40302</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40303"></span>40303</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40304"></span>40304</td>
<td class="instruction">SUB (IX+3)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40307"></span>40307</td>
<td class="instruction">JP P,<a href="40257.html#40312">40312</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40310"></span>40310</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="40312"></span>40312</td>
<td class="instruction">CP 16</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40314"></span>40314</td>
<td class="instruction">JR NC,<a href="40257.html#40282">40282</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40316"></span>40316</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="address-2"><span id="40317"></span>40317</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40318"></span>40318</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40319"></span>40319</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40320"></span>40320</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40321"></span>40321</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40322"></span>40322</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40323"></span>40323</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40324"></span>40324</td>
<td class="instruction">SUB (IX+4)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40327"></span>40327</td>
<td class="instruction">JP P,<a href="40257.html#40332">40332</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40330"></span>40330</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="40332"></span>40332</td>
<td class="instruction">CP 16</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40334"></span>40334</td>
<td class="instruction">JR NC,<a href="40257.html#40294">40294</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="40336"></span>40336</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="40227.html">40227</a>
</td>
<td class="up">Up: <a href="../maps/all.html#40257">Map</a></td>
<td class="next">
Next: <a href="40337.html">40337</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../../asm/9D41.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>