<!DOCTYPE html>
<html>
<head>
<title>Atic Atac: Routine at A00E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="9FFB.html">9FFB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a00e">Map</a></td>
<td class="next">
Next: <a href="A064.html">A064</a>
</td>
</tr>
</table>
<div class="description">A00E: Set Entity Attributes</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="A13B.html">DrawInventory</a> and <a href="A311.html">MenuIcons</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IX</td>
<td class="register-desc">The entity to colour</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes</td>
<td class="address-2"><span id="a00e"></span>A00E</td>
<td class="instruction">LD A,(IX+$03)</td>
<td class="comment-1" rowspan="2">Write the entity X position to <a href="5E16.html">Saved_X</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a011"></span>A011</td>
<td class="instruction">LD ($5E16),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a014"></span>A014</td>
<td class="instruction">LD A,(IX+$04)</td>
<td class="comment-1" rowspan="2">Write the entity X position to <a href="5E17.html">Saved_Y</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a017"></span>A017</td>
<td class="instruction">LD ($5E17),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a01a"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="8209.html">HandlerWeapon</a>, <a href="8301.html">HandlerBatlet</a>, <a href="8E26.html">HandlerKnight</a> and <a href="9252.html">HandlerCaveDoorLocked</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes_0</td>
<td class="address-2"><span id="a01a"></span>A01A</td>
<td class="instruction">LD L,(IX+$03)</td>
<td class="comment-1" rowspan="2"><span class="register">HL</span>=Entity screen position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a01d"></span>A01D</td>
<td class="instruction">LD H,(IX+$04)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a020"></span>A020</td>
<td class="instruction">LD D,(IX+$05)</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=Entity attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a023"></span>A023</td>
<td class="instruction">LD A,($5E1A)</td>
<td class="comment-1" rowspan="2"><span class="register">E</span>=Room attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a026"></span>A026</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a027"></span>A027</td>
<td class="instruction">LD A,($5E10)</td>
<td class="comment-1" rowspan="2"><span class="register">B</span>=Entity width in bytes.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a02a"></span>A02A</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a02b"></span>A02B</td>
<td class="instruction">LD A,($5E11)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Entity height in pixels.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a02e"></span>A02E</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="2">Divide by 04.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a02f"></span>A02F</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a030"></span>A030</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a031"></span>A031</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Divide by 02.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a032"></span>A032</td>
<td class="instruction">AND %00011111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a034"></span>A034</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a035"></span>A035</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Store the result in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a036"></span>A036</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a037"></span>A037</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=00.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a039"></span>A039</td>
<td class="instruction">LD A,($5E16)</td>
<td class="comment-1" rowspan="2">Compare <a href="5E16.html">Saved_X</a> against <span class="register">L</span> to see if the X position is unchanged.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a03c"></span>A03C</td>
<td class="instruction">CP L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a03d"></span>A03D</td>
<td class="instruction">JR Z,<a href="A00E.html#a043">SetEntityAttributes_2</a></td>
<td class="comment-1" rowspan="1">If it hasn't changed then jump to <a href="A00E.html#a043">SetEntityAttributes_2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a03f"></span>A03F</td>
<td class="instruction">JR C,<a href="A00E.html#a042">SetEntityAttributes_1</a></td>
<td class="comment-1" rowspan="1">If the entity has moved left then jump to <a href="A00E.html#a042">SetEntityAttributes_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a041"></span>A041</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">B</span> + 01.</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes_1</td>
<td class="address-2"><span id="a042"></span>A042</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">B</span> + 01.</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes_2</td>
<td class="address-2"><span id="a043"></span>A043</td>
<td class="instruction">LD A,($5E17)</td>
<td class="comment-1" rowspan="2">Compare <a href="5E17.html">Saved_Y</a> against <span class="register">H</span> to see if the Y position is unchanged.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a046"></span>A046</td>
<td class="instruction">CP H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a047"></span>A047</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a048"></span>A048</td>
<td class="instruction">JR Z,<a href="A00E.html#a050">SetEntityAttributes_4</a></td>
<td class="comment-1" rowspan="1">If it hasn't changed then jump to <a href="A00E.html#a050">SetEntityAttributes_4</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a04a"></span>A04A</td>
<td class="instruction">JR C,<a href="A00E.html#a04e">SetEntityAttributes_3</a></td>
<td class="comment-1" rowspan="1">If the entity has moved up then jump to <a href="A00E.html#a04e">SetEntityAttributes_3</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a04c"></span>A04C</td>
<td class="instruction">ADD A,$04</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">A</span> + 04.</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes_3</td>
<td class="address-2"><span id="a04e"></span>A04E</td>
<td class="instruction">ADD A,$04</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">A</span> + 04.</td>
</tr>
<tr>
<td class="asm-label">SetEntityAttributes_4</td>
<td class="address-2"><span id="a050"></span>A050</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Stash the result in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a051"></span>A051</td>
<td class="instruction">CALL <a href="9BD2.html">AttributeAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="9BD2.html">AttributeAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a054"></span>A054</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">Restore the result back into <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a055"></span>A055</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a056"></span>A056</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a057"></span>A057</td>
<td class="instruction">LD HL,$A064</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="A064.html">AttributeJumpTable</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a05a"></span>A05A</td>
<td class="instruction">SLA A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">A</span> * 02.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a05c"></span>A05C</td>
<td class="instruction">CALL <a href="9252.html#926c">HandlerCaveDoorLocked_1</a></td>
<td class="comment-1" rowspan="1">Call <a href="9252.html#926c">HandlerCaveDoorLocked_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a05f"></span>A05F</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4"><span class="register">HL</span>=attribute routine selected from <a href="A064.html">AttributeJumpTable</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a060"></span>A060</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a061"></span>A061</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a062"></span>A062</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a063"></span>A063</td>
<td class="instruction">JP (HL)</td>
<td class="comment-1" rowspan="1">Indirect jump to the address held in <span class="register">HL</span>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="9FFB.html">9FFB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a00e">Map</a></td>
<td class="next">
Next: <a href="A064.html">A064</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../dec/asm/40974.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>