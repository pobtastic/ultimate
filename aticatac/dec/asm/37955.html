<!DOCTYPE html>
<html>
<head>
<title>Atic Atac: Routine at 37955</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37935.html">37935</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37955">Map</a></td>
<td class="next">
Next: <a href="38025.html">38025</a>
</td>
</tr>
</table>
<div class="description">37955: Prepare Player</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="32154.html">StartGame</a> and <a href="35939.html">HandlerFoodItem</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="37955"></span>
<div class="comments">
<div class="paragraph">
Work out the sprite ID to use. <table class="default">
<tr>
<th colspan="1" rowspan="1">Byte</th>
<th colspan="1" rowspan="1">Character</th>
<th colspan="1" rowspan="1">* 2</th>
<th colspan="1" rowspan="1">Only Bits 4-5</th>
<th colspan="1" rowspan="1">+ 8</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">Knight (+ Keyboard)</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">Sprite ID: <a href="42174.html#42190">8</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">8</td>
<td class="centre" colspan="1" rowspan="1">Wizard (+ Kempston Joystick)</td>
<td class="centre" colspan="1" rowspan="1">16</td>
<td class="centre" colspan="1" rowspan="1">16</td>
<td class="centre" colspan="1" rowspan="1">Sprite ID: <a href="42174.html#42222">24</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">20</td>
<td class="centre" colspan="1" rowspan="1">Serf (+ Cursor Joystick)</td>
<td class="centre" colspan="1" rowspan="1">40</td>
<td class="centre" colspan="1" rowspan="1">32</td>
<td class="centre" colspan="1" rowspan="1">Sprite ID: <a href="42174.html#42254">40</a></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PreparePlayer</td>
<td class="address-2"><span id="37955"></span>37955</td>
<td class="instruction">LD A,(24064)</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="24064.html">GameOptions</a> * 2.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37958"></span>37958</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37959"></span>37959</td>
<td class="instruction">AND %00110000</td>
<td class="comment-1" rowspan="2">Keep only bits 4-5 (the base character address) + 8 frames (for the character direction).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37961"></span>37961</td>
<td class="instruction">ADD A,8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37963"></span>37963</td>
<td class="instruction">LD (38024),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to <a href="37955.html#38017">38024</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="37966"></span>
<div class="comments">
<div class="paragraph">
Update the current room.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37966"></span>37966</td>
<td class="instruction">LD A,(60049)</td>
<td class="comment-1" rowspan="2">Write <a href="60049.html">PlayerRoom</a> to <a href="37955.html#38017">38018</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37969"></span>37969</td>
<td class="instruction">LD (38018),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37972"></span>37972</td>
<td class="instruction">LD HL,38017</td>
<td class="comment-1" rowspan="4">Copy 8 bytes of data from <a href="37955.html#38017">38017</a> to <a href="60048.html">Player</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37975"></span>37975</td>
<td class="instruction">LD DE,60048</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37978"></span>37978</td>
<td class="instruction">LD BC,8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37981"></span>37981</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37983"></span>37983</td>
<td class="instruction">LD A,104</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37985"></span>37985</td>
<td class="instruction">LD (24124),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37988"></span>37988</td>
<td class="instruction">LD A,(24097)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37991"></span>37991</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37993"></span>37993</td>
<td class="instruction">JR Z,<a href="37955.html#38006">PreparePlayer_0</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37995"></span>37995</td>
<td class="instruction">PUSH IX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="37997"></span>37997</td>
<td class="instruction">LD IX,60048</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38001"></span>38001</td>
<td class="instruction">CALL <a href="40778.html">DrawEntity</a></td>
<td class="comment-1" rowspan="1">Call <a href="40778.html">DrawEntity</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38004"></span>38004</td>
<td class="instruction">POP IX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="38006"></span>
<div class="comments">
<div class="paragraph">
Set starting energy.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PreparePlayer_0</td>
<td class="address-2"><span id="38006"></span>38006</td>
<td class="instruction">LD A,240</td>
<td class="comment-1" rowspan="2">Write 240 to <a href="24104.html">PlayerEnergy</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38008"></span>38008</td>
<td class="instruction">LD (24104),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38011"></span>38011</td>
<td class="instruction">CALL <a href="35722.html">DrawChicken</a></td>
<td class="comment-1" rowspan="1">Call <a href="35722.html">DrawChicken</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38014"></span>38014</td>
<td class="instruction">JP <a href="41678.html">DrawLives</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="41678.html">DrawLives</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="38017"></span>38017</td>
<td class="instruction">DEFB 102,0,0,96,104,71,255,0</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37935.html">37935</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37955">Map</a></td>
<td class="next">
Next: <a href="38025.html">38025</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6.</div>
<div><a href="../../hex/asm/9443.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>