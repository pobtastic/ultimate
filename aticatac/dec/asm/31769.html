<!DOCTYPE html>
<html>
<head>
<title>Atic Atac: Routine at 31769</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31767.html">31767</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31769">Map</a></td>
<td class="next">
Next: <a href="31888.html">31888</a>
</td>
</tr>
</table>
<div class="description">31769: Game Entry Point</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="24576.html">SecurityCheck</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation</td>
<td class="address-2"><span id="31769"></span>31769</td>
<td class="instruction">LD HL,24064</td>
<td class="comment-1" rowspan="5">Write 0 to 16 bytes, from <a href="24064.html">GameOptions</a> to 24080.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31772"></span>31772</td>
<td class="instruction">LD B,16</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation_Loop</td>
<td class="address-2"><span id="31774"></span>31774</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31776"></span>31776</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31777"></span>31777</td>
<td class="instruction">DJNZ <a href="31769.html#31774">GameInitialisation_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31779"></span>31779</td>
<td class="instruction">LD HL,48716</td>
<td class="comment-1" rowspan="2">Write <a href="48716.html">MainFont</a> to <a href="24065.html">FontPointer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31782"></span>31782</td>
<td class="instruction">LD (24065),HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31785"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="35893.html">GameOver</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Game_Restart</td>
<td class="address-2"><span id="31785"></span>31785</td>
<td class="instruction">CALL <a href="32938.html">ClearScreen</a></td>
<td class="comment-1" rowspan="1">Call <a href="32938.html">ClearScreen</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31788"></span>31788</td>
<td class="instruction">CALL <a href="41745.html">MenuIcons</a></td>
<td class="comment-1" rowspan="1">Call <a href="41745.html">MenuIcons</a>.</td>
</tr>
<tr>
<td class="asm-label">GameSelect_Loop</td>
<td class="address-2"><span id="31791"></span>31791</td>
<td class="instruction">CALL <a href="31919.html">GameMenu</a></td>
<td class="comment-1" rowspan="1">Call <a href="31919.html">GameMenu</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31794"></span>31794</td>
<td class="instruction">LD A,247</td>
<td class="comment-1" rowspan="3">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">247</td>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">5</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31796"></span>31796</td>
<td class="instruction">OUT (253),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31798"></span>31798</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31800"></span>31800</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Flip the bits.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31801"></span>31801</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31802"></span>31802</td>
<td class="instruction">LD A,(24064)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="24064.html">GameOptions</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31805"></span>
<div class="comments">
<div class="paragraph">
Handle Keyboard selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31805"></span>31805</td>
<td class="instruction">BIT 0,E</td>
<td class="comment-1" rowspan="1">Has key "1" been pressed? ("KEYBOARD").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31807"></span>31807</td>
<td class="instruction">JR Z,<a href="31769.html#31811">GameSelect_CheckKempston</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="31769.html#31811">GameSelect_CheckKempston</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31809"></span>31809</td>
<td class="instruction">AND %11111001</td>
<td class="comment-1" rowspan="1">Keep only bits 0, 3-7.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31811"></span>
<div class="comments">
<div class="paragraph">
Handle Kempston Joystick selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckKempston</td>
<td class="address-2"><span id="31811"></span>31811</td>
<td class="instruction">BIT 1,E</td>
<td class="comment-1" rowspan="1">Has key "2" been pressed? ("KEMPSTON JOYSTICK").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31813"></span>31813</td>
<td class="instruction">JR Z,<a href="31769.html#31819">GameSelect_CheckCursor</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="31769.html#31819">GameSelect_CheckCursor</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31815"></span>31815</td>
<td class="instruction">AND %11111001</td>
<td class="comment-1" rowspan="1">Keep only bits 0, 3-7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31817"></span>31817</td>
<td class="instruction">OR %00000010</td>
<td class="comment-1" rowspan="1">Set control method = 2.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31819"></span>
<div class="comments">
<div class="paragraph">
Handle Cursor Joystick selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckCursor</td>
<td class="address-2"><span id="31819"></span>31819</td>
<td class="instruction">BIT 2,E</td>
<td class="comment-1" rowspan="1">Has key "3" been pressed? ("CURSOR JOYSTICK").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31821"></span>31821</td>
<td class="instruction">JR Z,<a href="31769.html#31827">GameSelect_CheckKnight</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="31769.html#31827">GameSelect_CheckKnight</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31823"></span>31823</td>
<td class="instruction">AND %11111001</td>
<td class="comment-1" rowspan="1">Keep only bits 0, 3-7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31825"></span>31825</td>
<td class="instruction">OR %00000100</td>
<td class="comment-1" rowspan="1">Set control method = 4.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31827"></span>
<div class="comments">
<div class="paragraph">
Handle "Knight" selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckKnight</td>
<td class="address-2"><span id="31827"></span>31827</td>
<td class="instruction">BIT 3,E</td>
<td class="comment-1" rowspan="1">Has key "4" been pressed? ("KNIGHT").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31829"></span>31829</td>
<td class="instruction">JR Z,<a href="31769.html#31833">GameSelect_CheckWizard</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="31769.html#31833">GameSelect_CheckWizard</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31831"></span>31831</td>
<td class="instruction">AND %11100111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-2, 5-7.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31833"></span>
<div class="comments">
<div class="paragraph">
Handle "Wizard" selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckWizard</td>
<td class="address-2"><span id="31833"></span>31833</td>
<td class="instruction">BIT 4,E</td>
<td class="comment-1" rowspan="1">Has key "5" been pressed? ("WIZARD").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31835"></span>31835</td>
<td class="instruction">JR Z,<a href="31769.html#31841">GameInitialisation_0</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="31769.html#31841">GameInitialisation_0</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31837"></span>31837</td>
<td class="instruction">AND %11100111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-2, 5-7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31839"></span>31839</td>
<td class="instruction">OR %00001000</td>
<td class="comment-1" rowspan="1">Set player = 8.</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation_0</td>
<td class="address-2"><span id="31841"></span>31841</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31842"></span>31842</td>
<td class="instruction">LD A,239</td>
<td class="comment-1" rowspan="3">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">239</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">9</td>
<td class="centre" colspan="1" rowspan="1">8</td>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="centre" colspan="1" rowspan="1">6</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31844"></span>31844</td>
<td class="instruction">OUT (253),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31846"></span>31846</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31848"></span>31848</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Flip the bits.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31849"></span>31849</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31850"></span>31850</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31851"></span>
<div class="comments">
<div class="paragraph">
Handle choosing "Serf".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckSerf</td>
<td class="address-1"><span id="31851"></span>31851</td>
<td class="instruction">BIT 4,E</td>
<td class="comment-1" rowspan="1">Has key "6" been pressed? ("SERF").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31853"></span>31853</td>
<td class="instruction">JR Z,<a href="31769.html#31859">GameInitialisation_1</a></td>
<td class="comment-1" rowspan="1">If not skip to <a href="31769.html#31859">GameInitialisation_1</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31855"></span>31855</td>
<td class="instruction">AND %11100111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-2, 5-7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31857"></span>31857</td>
<td class="instruction">OR %00010000</td>
<td class="comment-1" rowspan="1">Set bit 4.</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation_1</td>
<td class="address-2"><span id="31859"></span>31859</td>
<td class="instruction">LD (24064),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31862"></span>31862</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31863"></span>
<div class="comments">
<div class="paragraph">
Handle starting a new game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_Start</td>
<td class="address-1"><span id="31863"></span>31863</td>
<td class="instruction">BIT 0,E</td>
<td class="comment-1" rowspan="1">Has key "0" been pressed? ("START GAME").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31865"></span>31865</td>
<td class="instruction">JP NZ,<a href="32154.html">StartGame</a></td>
<td class="comment-1" rowspan="1">If so, jump to <a href="32154.html">StartGame</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31868"></span>31868</td>
<td class="instruction">LD HL,31978</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="31978.html">GameSelection_Attributes</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31871"></span>31871</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=3 (counter).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31873"></span>31873</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31874"></span>31874</td>
<td class="instruction">CALL <a href="31888.html">31888</a></td>
<td class="comment-1" rowspan="1">Call <a href="31888.html">31888</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31877"></span>31877</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=3 (counter).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31879"></span>31879</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=<span class="register">C</span> / 4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31880"></span>31880</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31881"></span>31881</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31882"></span>31882</td>
<td class="instruction">CALL <a href="31888.html">31888</a></td>
<td class="comment-1" rowspan="1">Call <a href="31888.html">31888</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="31885"></span>31885</td>
<td class="instruction">JP <a href="31769.html#31791">GameSelect_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="31769.html#31791">GameSelect_Loop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
View the equivalent code in; <ul class="">
<li><a href="../../../cookie/dec/asm/25240.html">Cookie</a></li>
<li><a href="../../../lunarjetman/dec/asm/32778.html">Lunar Jetman</a></li>
<li><a href="../../../pssst/dec/asm/25037.html">Pssst</a></li>
<li><a href="../../../tranzam/dec/asm/24327.html">Tranz Am</a></li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31767.html">31767</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31769">Map</a></td>
<td class="next">
Next: <a href="31888.html">31888</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6.</div>
<div><a href="../../hex/asm/7C19.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>