<!DOCTYPE html>
<html>
<head>
<title>PSSST: Routine at 30160</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="ultimate" src="../images/ultimate.png" /> <img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30156.html">30156</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30160">Map</a></td>
<td class="next">
Next: <a href="30234.html">30234</a>
</td>
</tr>
</table>
<div class="description">30160: Erase Sprite</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="29861.html">29861</a> and <a href="29980.html">29980</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Loop counter</td>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Actor Y position, or zero?</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address into a sprite/buffer</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address in the DISPLAY_FILE</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="30160"></span>30160</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="3">Jump to <a href="30160.html#30203">30203</a> if the sprites vertical position is zero.</td>
</tr>
<tr>
<td class="address-1"><span id="30161"></span>30161</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="30162"></span>30162</td>
<td class="instruction">JR Z,<a href="30160.html#30203">30203</a></td>
</tr>
<tr>
<td class="address-1"><span id="30164"></span>30164</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Else decrement.</td>
</tr>
<tr>
<td class="address-1"><span id="30165"></span>30165</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash <span class="register">BC</span> and <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30166"></span>30166</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30167"></span>
<div class="comments">
<div class="paragraph">
Loop to create a mask of the sprite and it write to the screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="30167"></span>30167</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=sprite byte.</td>
</tr>
<tr>
<td class="address-1"><span id="30168"></span>30168</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="3">Create mask and write to screen.</td>
</tr>
<tr>
<td class="address-1"><span id="30169"></span>30169</td>
<td class="instruction">AND (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="30170"></span>30170</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="30171"></span>30171</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Move onto the next byte.</td>
</tr>
<tr>
<td class="address-1"><span id="30172"></span>30172</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Move onto the next column.</td>
</tr>
<tr>
<td class="address-1"><span id="30173"></span>30173</td>
<td class="instruction">DJNZ <a href="30160.html#30167">30167</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="30160.html#30167">30167</a> until counter is zero.</td>
</tr>
<tr>
<td class="address-1"><span id="30175"></span>30175</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30176"></span>30176</td>
<td class="instruction">CALL <a href="30085.html">30085</a></td>
<td class="comment-1" rowspan="1">Call <a href="30085.html">30085</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="30179"></span>30179</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30180"></span>30180</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30181"></span>30181</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="3">Jump to <a href="30160.html#30200">30200</a> if <span class="register">C</span> is zero.</td>
</tr>
<tr>
<td class="address-1"><span id="30182"></span>30182</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="30183"></span>30183</td>
<td class="instruction">JR Z,<a href="30160.html#30200">30200</a></td>
</tr>
<tr>
<td class="address-2"><span id="30185"></span>30185</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30186"></span>30186</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash <span class="register">BC</span> and <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30187"></span>30187</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-2"><span id="30188"></span>30188</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30189"></span>30189</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30190"></span>30190</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30191"></span>30191</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30192"></span>30192</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30193"></span>30193</td>
<td class="instruction">DJNZ <a href="30160.html#30188">30188</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30195"></span>30195</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="address-1"><span id="30196"></span>30196</td>
<td class="instruction">CALL <a href="30085.html">30085</a></td>
<td class="comment-1" rowspan="1">Call <a href="30085.html">30085</a>.</td>
</tr>
<tr>
<td class="address-1"><span id="30199"></span>30199</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="address-2"><span id="30200"></span>30200</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30201"></span>30201</td>
<td class="instruction">JR <a href="30160.html#30160">30160</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="30203"></span>30203</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30204"></span>30204</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30205"></span>30205</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30206"></span>30206</td>
<td class="instruction">JR NZ,<a href="30160.html#30185">30185</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30208"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29861.html">29861</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="30208"></span>30208</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30209"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29861.html">29861</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="30209"></span>30209</td>
<td class="instruction">LD A,(24080)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30212"></span>30212</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30213"></span>30213</td>
<td class="instruction">LD A,(24081)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30216"></span>30216</td>
<td class="instruction">OR C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30217"></span>30217</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30218"></span>30218</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30219"></span>30219</td>
<td class="instruction">LD (24080),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30222"></span>30222</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30223"></span>30223</td>
<td class="instruction">LD A,(24081)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30226"></span>30226</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30227"></span>30227</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30228"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29861.html">29861</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="30228"></span>30228</td>
<td class="instruction">LD (24081),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30231"></span>30231</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="30232"></span>30232</td>
<td class="instruction">JR <a href="30160.html#30160">30160</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30156.html">30156</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30160">Map</a></td>
<td class="next">
Next: <a href="30234.html">30234</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6.</div>
<div><a href="../../asm/75D0.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>