<!DOCTYPE html>
<html>
<head>
<title>PSSST: Routine at 25037</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="ultimate" src="../images/ultimate.png" /> <img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25030.html">25030</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25037">Map</a></td>
<td class="next">
Next: <a href="25168.html">25168</a>
</td>
</tr>
</table>
<div class="description">25037: Game Initialisation</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25037"></span>
<div class="comments">
<div class="paragraph">
Blank the 1UP, 2UP and HI scores.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation</td>
<td class="address-2"><span id="25037"></span>25037</td>
<td class="instruction">LD HL,24064</td>
<td class="comment-1" rowspan="5">Write 0 to 11 bytes from 24064 to 24075.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25040"></span>25040</td>
<td class="instruction">LD BC,2816</td>
</tr>
<tr>
<td class="asm-label">GameInitialisation_Loop</td>
<td class="address-2"><span id="25043"></span>25043</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25044"></span>25044</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25045"></span>25045</td>
<td class="instruction">DJNZ <a href="25037.html#25043">GameInitialisation_Loop</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25047"></span>
<div class="comments">
<div class="paragraph">
This calculates a "checksum" of the <a href="https://skoolkid.github.io/rom/asm/03B5.html">BEEPER</a> routine. The expected value at the end is 0 and if <a href="24068.html">Sound_Enable</a> does not contain 0 then the game is muted.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25047"></span>25047</td>
<td class="instruction">LD HL,949</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="https://skoolkid.github.io/rom/asm/03B5.html">BEEPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25050"></span>25050</td>
<td class="instruction">LD B,67</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=67 (counter).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25052"></span>25052</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0.</td>
</tr>
<tr>
<td class="asm-label">Mute_Loop</td>
<td class="address-2"><span id="25053"></span>25053</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1">Add the byte at <span class="register">HL</span> to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25054"></span>25054</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25055"></span>25055</td>
<td class="instruction">DJNZ <a href="25037.html#25053">Mute_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="25037.html#25053">Mute_Loop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25057"></span>25057</td>
<td class="instruction">ADD A,104</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">A</span> + 104.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25059"></span>25059</td>
<td class="instruction">LD (24068),A</td>
<td class="comment-1" rowspan="1">Store this number at <a href="24068.html">Sound_Enable</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25062"></span>25062</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 0 to <a href="https://skoolkit.ca/disassemblies/rom/hex/asm/5C48.html">BORDCR</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25063"></span>25063</td>
<td class="instruction">LD (23624),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25066"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="24829.html">GameOver1UP</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Game_Restart</td>
<td class="address-2"><span id="25066"></span>25066</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25067"></span>25067</td>
<td class="instruction">LD SP,23808</td>
<td class="comment-1" rowspan="1">Set the stack pointer to 23808.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25070"></span>25070</td>
<td class="instruction">CALL <a href="24403.html">CreateWindow</a></td>
<td class="comment-1" rowspan="1">Call <a href="24403.html">CreateWindow</a>.</td>
</tr>
<tr>
<td class="asm-label">GameSelect_Loop</td>
<td class="address-2"><span id="25073"></span>25073</td>
<td class="instruction">CALL <a href="25168.html">GameMenu</a></td>
<td class="comment-1" rowspan="1">Call <a href="25168.html">GameMenu</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25076"></span>25076</td>
<td class="instruction">LD A,(24067)</td>
<td class="comment-1" rowspan="2"><span class="register">D</span>=<a href="24067.html">GameOptions</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25079"></span>25079</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25080"></span>25080</td>
<td class="instruction">LD A,247</td>
<td class="comment-1" rowspan="3">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">247</td>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">5</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25082"></span>25082</td>
<td class="instruction">OUT (253),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25084"></span>25084</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25086"></span>25086</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1">Flip the bits.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25087"></span>
<div class="comments">
<div class="paragraph">
Handle 1UP selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25087"></span>25087</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-1" rowspan="1">Has key "1" been pressed? ("1 PLAYER GAME").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25089"></span>25089</td>
<td class="instruction">JR Z,<a href="25037.html#25093">GameSelect_CheckP2</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="25037.html#25093">GameSelect_CheckP2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25091"></span>25091</td>
<td class="instruction">RES 0,D</td>
<td class="comment-1" rowspan="1">Set player count = 1.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25093"></span>
<div class="comments">
<div class="paragraph">
Handle 2UP selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckP2</td>
<td class="address-2"><span id="25093"></span>25093</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-1" rowspan="1">Has key "2" been pressed? ("2 PLAYER GAME").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25095"></span>25095</td>
<td class="instruction">JR Z,<a href="25037.html#25099">GameSelect_CheckKeyboard</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="25037.html#25099">GameSelect_CheckKeyboard</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25097"></span>25097</td>
<td class="instruction">SET 0,D</td>
<td class="comment-1" rowspan="1">Set player count = 2.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25099"></span>
<div class="comments">
<div class="paragraph">
Handle Keyboard selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckKeyboard</td>
<td class="address-2"><span id="25099"></span>25099</td>
<td class="instruction">BIT 2,A</td>
<td class="comment-1" rowspan="1">Has key "3" been pressed? ("KEYBOARD").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25101"></span>25101</td>
<td class="instruction">JR Z,<a href="25037.html#25105">GameSelect_CheckKempston</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="25037.html#25105">GameSelect_CheckKempston</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25103"></span>25103</td>
<td class="instruction">RES 1,D</td>
<td class="comment-1" rowspan="1">Set control method = keyboard.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25105"></span>
<div class="comments">
<div class="paragraph">
Handle Kempston Joystick selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_CheckKempston</td>
<td class="address-2"><span id="25105"></span>25105</td>
<td class="instruction">BIT 3,A</td>
<td class="comment-1" rowspan="1">Has key "4" been pressed? ("KEMPSTON JOYSTICK").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25107"></span>25107</td>
<td class="instruction">JR Z,<a href="25037.html#25111">GameSelect_StartGame</a></td>
<td class="comment-1" rowspan="1">If not jump to <a href="25037.html#25111">GameSelect_StartGame</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25109"></span>25109</td>
<td class="instruction">SET 1,D</td>
<td class="comment-1" rowspan="1">Set control method = joystick.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25111"></span>
<div class="comments">
<div class="paragraph">
Handle starting a new game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameSelect_StartGame</td>
<td class="address-2"><span id="25111"></span>25111</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-1" rowspan="1">Has key "5" been pressed? ("START GAME").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25113"></span>25113</td>
<td class="instruction">JP NZ,<a href="25374.html#25389">GameStart</a></td>
<td class="comment-1" rowspan="1">If so, jump to <a href="25374.html#25389">GameStart</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25116"></span>
<div class="comments">
<div class="paragraph">
Handle flashing each selection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25116"></span>25116</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="2">Write <span class="register">D</span> to <a href="24067.html">GameOptions</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25117"></span>25117</td>
<td class="instruction">LD (24067),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25120"></span>25120</td>
<td class="instruction">LD HL,25213</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="25212.html#25213">GameSelection_Attributes</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25123"></span>25123</td>
<td class="instruction">LD A,(24067)</td>
<td class="comment-1" rowspan="2"><span class="register">C</span>=<a href="24067.html">GameOptions</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25126"></span>25126</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label">MenuAttributeCheckPlayer</td>
<td class="address-1"><span id="25127"></span>25127</td>
<td class="instruction">BIT 0,C</td>
<td class="comment-1" rowspan="2">If a 2UP game is selected, jump to <a href="25037.html#25144">MenuAttrHandle2UP</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25129"></span>25129</td>
<td class="instruction">JR NZ,<a href="25037.html#25144">MenuAttrHandle2UP</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25131"></span>25131</td>
<td class="instruction">CALL <a href="25037.html#25154">MenuAttributeSetFirst</a></td>
<td class="comment-1" rowspan="1">Else, call <a href="25037.html#25154">MenuAttributeSetFirst</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25134"></span>
<div class="comments">
<div class="paragraph">
Check control method.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MenuAttributeCheckControl</td>
<td class="address-2"><span id="25134"></span>25134</td>
<td class="instruction">BIT 1,C</td>
<td class="comment-1" rowspan="2">If joystick is selected, jump to <a href="25037.html#25149">MenuAttrHandleJoystick</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25136"></span>25136</td>
<td class="instruction">JR NZ,<a href="25037.html#25149">MenuAttrHandleJoystick</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25138"></span>25138</td>
<td class="instruction">CALL <a href="25037.html#25154">MenuAttributeSetFirst</a></td>
<td class="comment-1" rowspan="1">Else, call <a href="25037.html#25154">MenuAttributeSetFirst</a>.</td>
</tr>
<tr>
<td class="asm-label">GameSelect_End</td>
<td class="address-2"><span id="25141"></span>25141</td>
<td class="instruction">JP <a href="25037.html#25073">GameSelect_Loop</a></td>
<td class="comment-1" rowspan="1">Jump back to <a href="25037.html#25073">GameSelect_Loop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25144"></span>
<div class="comments">
<div class="paragraph">
Handle flashing 2UP.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MenuAttrHandle2UP</td>
<td class="address-2"><span id="25144"></span>25144</td>
<td class="instruction">CALL <a href="25037.html#25161">MenuAttributeSetSecond</a></td>
<td class="comment-1" rowspan="1">Call <a href="25037.html#25161">MenuAttributeSetSecond</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25147"></span>25147</td>
<td class="instruction">JR <a href="25037.html#25134">MenuAttributeCheckControl</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="25037.html#25134">MenuAttributeCheckControl</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25149"></span>
<div class="comments">
<div class="paragraph">
Handle flashing joystick.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MenuAttrHandleJoystick</td>
<td class="address-2"><span id="25149"></span>25149</td>
<td class="instruction">CALL <a href="25037.html#25161">MenuAttributeSetSecond</a></td>
<td class="comment-1" rowspan="1">Call <a href="25037.html#25161">MenuAttributeSetSecond</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25152"></span>25152</td>
<td class="instruction">JR <a href="25037.html#25141">GameSelect_End</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="25037.html#25141">GameSelect_End</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25154"></span>
<div class="comments">
<div class="paragraph">
Set the first menu item, unset the second.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MenuAttributeSetFirst</td>
<td class="address-2"><span id="25154"></span>25154</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-1" rowspan="1">Set the FLASH attribute for the first selection.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25156"></span>25156</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move onto the next menu attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25157"></span>25157</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-1" rowspan="1">Unset the FLASH attribute for the second selection.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25159"></span>25159</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move onto the next menu selection attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25160"></span>25160</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25161"></span>
<div class="comments">
<div class="paragraph">
Unset the first menu item, set the second.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MenuAttributeSetSecond</td>
<td class="address-2"><span id="25161"></span>25161</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-1" rowspan="1">Unset the FLASH attribute for the first selection.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25163"></span>25163</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move onto the next menu attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25164"></span>25164</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-1" rowspan="1">Set the FLASH attribute for the second selection.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25166"></span>25166</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move onto the next menu selection attribute.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="25167"></span>25167</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
View the equivalent code in; <ul class="">
<li><a href="../../../aticatac/dec/asm/31769.html">Atic Atac</a></li>
<li><a href="../../../cookie/dec/asm/25240.html">Cookie</a></li>
<li><a href="../../../jetpac/dec/asm/0.html">Jetpac</a></li>
<li><a href="../../../lunarjetman/dec/asm/32778.html">Lunar Jetman</a></li>
<li><a href="../../../tranzam/dec/asm/24327.html">Tranz Am</a></li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25030.html">25030</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25037">Map</a></td>
<td class="next">
Next: <a href="25168.html">25168</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6.</div>
<div><a href="../../hex/asm/61CD.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>