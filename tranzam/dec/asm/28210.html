<!DOCTYPE html>
<html>
<head>
<title>Tranz Am: Routine at 28210</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28019.html">28019</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28210">Map</a></td>
<td class="next">
Next: <a href="28363.html">28363</a>
</td>
</tr>
</table>
<div class="description">28210: Routine at 6E32</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="28019.html">HandlerAccelerate</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28210"></span>28210</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28211"></span>28211</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28212"></span>28212</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28214"></span>28214</td>
<td class="instruction">SBC A,0</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28216"></span>28216</td>
<td class="instruction">JR NZ,<a href="28019.html#28132">HandlerAccelerate_4</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28218"></span>28218</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28219"></span>28219</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28220"></span>28220</td>
<td class="instruction">CP 128</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28222"></span>28222</td>
<td class="instruction">JR C,<a href="28019.html#28185">HandlerAccelerate_8</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28224"></span>28224</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28225"></span>28225</td>
<td class="instruction">JR <a href="28019.html#28132">HandlerAccelerate_4</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28227"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="28019.html">HandlerAccelerate</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28227"></span>28227</td>
<td class="instruction">LD A,(24133)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28230"></span>28230</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28231"></span>28231</td>
<td class="instruction">JR Z,<a href="28210.html#28244">28244</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28233"></span>28233</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28234"></span>28234</td>
<td class="instruction">LD (24133),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28237"></span>28237</td>
<td class="instruction">JR Z,<a href="28210.html#28241">28241</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28239"></span>28239</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28241"></span>28241</td>
<td class="instruction">LD (24135),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28244"></span>28244</td>
<td class="instruction">CALL <a href="24972.html">ReadInputLR</a></td>
<td class="comment-1" rowspan="1">Call <a href="24972.html">ReadInputLR</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28247"></span>28247</td>
<td class="instruction">LD HL,(24080)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28250"></span>28250</td>
<td class="instruction">LD E,24</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28252"></span>28252</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28254"></span>28254</td>
<td class="instruction">JP Z,<a href="28210.html#28278">28278</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28257"></span>28257</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28259"></span>28259</td>
<td class="instruction">JP Z,<a href="28210.html#28268">28268</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28262"></span>28262</td>
<td class="instruction">LD E,0</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28264"></span>28264</td>
<td class="instruction">JR <a href="28210.html#28286">HandlerFuel</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28210.html#28286">HandlerFuel</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28266"></span>28266</td>
<td class="instruction">LD E,24</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=24.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28268"></span>28268</td>
<td class="instruction">LD D,0</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28270"></span>28270</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28271"></span>28271</td>
<td class="instruction">LD (24080),HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28274"></span>28274</td>
<td class="instruction">JR <a href="28210.html#28286">HandlerFuel</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28210.html#28286">HandlerFuel</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28276"></span>28276</td>
<td class="instruction">LD E,24</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=24.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28278"></span>28278</td>
<td class="instruction">LD D,0</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28280"></span>28280</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28281"></span>28281</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28283"></span>28283</td>
<td class="instruction">LD (24080),HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28286"></span>
<div class="comments">
<div class="paragraph">
Don't "use fuel" on every frame. This routine uses the last two bits of the <a href="24105.html">GameTimer</a> (i.e. a number between 0-3) to only process every fourth frame.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">HandlerFuel</td>
<td class="address-2"><span id="28286"></span>28286</td>
<td class="instruction">LD A,(24105)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="24105.html">GameTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28289"></span>28289</td>
<td class="instruction">AND %00000011</td>
<td class="comment-1" rowspan="1">Keep only bits 0-1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28291"></span>28291</td>
<td class="instruction">JR NZ,<a href="28210.html#28315">HandlerTemperatureGauge</a></td>
<td class="comment-1" rowspan="1">If the result is not zero then jump to <a href="28210.html#28315">HandlerTemperatureGauge</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28293"></span>
<div class="comments">
<div class="paragraph">
Handles "using" fuel.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28293"></span>28293</td>
<td class="instruction">LD A,(24077)</td>
<td class="comment-1" rowspan="3"><span class="register">B</span>=0 <span class="register">C</span>=<a href="24077.html">Speed</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28296"></span>28296</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28297"></span>28297</td>
<td class="instruction">LD B,0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28299"></span>28299</td>
<td class="instruction">LD HL,(24074)</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="24074.html">Fuel_LSB</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28302"></span>
<div class="comments">
<div class="paragraph">
A higher speed uses more fuel.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28302"></span>28302</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<span class="register">HL</span> (fuel) - <span class="register">BC</span> (speed).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28304"></span>28304</td>
<td class="instruction">JR C,<a href="28210.html#28309">FuelSkipWrite</a></td>
<td class="comment-1" rowspan="1">If there's "carry" (i.e. if the player has run out of fuel) jump to <a href="28210.html#28309">FuelSkipWrite</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28306"></span>28306</td>
<td class="instruction">LD (24074),HL</td>
<td class="comment-1" rowspan="1">Write <span class="register">HL</span> to <a href="24074.html">Fuel_LSB</a>.</td>
</tr>
<tr>
<td class="asm-label">FuelSkipWrite</td>
<td class="address-2"><span id="28309"></span>28309</td>
<td class="instruction">CP 176</td>
<td class="comment-1" rowspan="2">If the current speed is more than 176 (top speed) jump to <a href="28210.html#28335">TemperatureMaxSpeed</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28311"></span>28311</td>
<td class="instruction">JR NC,<a href="28210.html#28335">TemperatureMaxSpeed</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28313"></span>28313</td>
<td class="instruction">CP 96</td>
<td class="comment-1" rowspan="1">Compare current speed with 96.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28315"></span>
<div class="comments">
<div class="paragraph">
Handle the temperature gauge.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">HandlerTemperatureGauge</td>
<td class="address-2"><span id="28315"></span>28315</td>
<td class="instruction">LD A,(24076)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="24076.html">Temperature</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28318"></span>28318</td>
<td class="instruction">JR C,<a href="28210.html#28348">TemperatureDrop</a></td>
<td class="comment-1" rowspan="1">If there's carry set (this could be either from <a href="28210.html#28313">28313</a> or <a href="28210.html#28289">28289</a>) then jump to <a href="28210.html#28348">TemperatureDrop</a>.</td>
</tr>
<tr>
<td class="asm-label">DrawTemperatureGauge</td>
<td class="address-2"><span id="28320"></span>28320</td>
<td class="instruction">LD HL,20834</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=20834 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28323"></span>28323</td>
<td class="instruction">CALL <a href="28382.html">DrawGaugeLine</a></td>
<td class="comment-1" rowspan="1">Call <a href="28382.html">DrawGaugeLine</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28326"></span>
<div class="comments">
<div class="paragraph">
Handle the fuel gauge.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28326"></span>28326</td>
<td class="instruction">LD A,(24075)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="24074.html#24075">Fuel_MSB</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28329"></span>28329</td>
<td class="instruction">LD HL,20770</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=20770 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28332"></span>28332</td>
<td class="instruction">JP <a href="28382.html">DrawGaugeLine</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28382.html">DrawGaugeLine</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28335"></span>
<div class="comments">
<div class="paragraph">
Handle the temperature gauge at maximum speed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">TemperatureMaxSpeed</td>
<td class="address-2"><span id="28335"></span>28335</td>
<td class="instruction">LD A,(24076)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="24076.html">Temperature</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28338"></span>
<div class="comments">
<div class="paragraph">
Check if the temperature is already at the upper limit.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28338"></span>28338</td>
<td class="instruction">CP 192</td>
<td class="comment-1" rowspan="2">If the current temperature is more than 192 jump to <a href="28210.html#28320">DrawTemperatureGauge</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28340"></span>28340</td>
<td class="instruction">JR NC,<a href="28210.html#28320">DrawTemperatureGauge</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28342"></span>
<div class="comments">
<div class="paragraph">
Go ahead and increase the temperature...
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28342"></span>28342</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label">UpdateTemperature</td>
<td class="address-2"><span id="28343"></span>28343</td>
<td class="instruction">LD (24076),A</td>
<td class="comment-1" rowspan="1">Write the updated <span class="register">A</span> (temperature) back to <a href="24076.html">Temperature</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28346"></span>28346</td>
<td class="instruction">JR <a href="28210.html#28320">DrawTemperatureGauge</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28210.html#28320">DrawTemperatureGauge</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28348"></span>
<div class="comments">
<div class="paragraph">
Handles dropping the temperature gauge.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">TemperatureDrop</td>
<td class="address-2"><span id="28348"></span>28348</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="2">If the current temperature is at zero jump to <a href="28210.html#28320">DrawTemperatureGauge</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28349"></span>28349</td>
<td class="instruction">JR Z,<a href="28210.html#28320">DrawTemperatureGauge</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28351"></span>28351</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">A</span> (temperature) by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28352"></span>28352</td>
<td class="instruction">JR <a href="28210.html#28343">UpdateTemperature</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28210.html#28343">UpdateTemperature</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28354"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="28019.html">HandlerAccelerate</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28354"></span>28354</td>
<td class="instruction">LD B,5</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=5.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="28356"></span>28356</td>
<td class="instruction">SRL H</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28358"></span>28358</td>
<td class="instruction">RR L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28360"></span>28360</td>
<td class="instruction">DJNZ <a href="28210.html#28356">28356</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28210.html#28356">28356</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28362"></span>28362</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28019.html">28019</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28210">Map</a></td>
<td class="next">
Next: <a href="28363.html">28363</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../../asm/6E32.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>