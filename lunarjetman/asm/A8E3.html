<!DOCTYPE html>
<html>
<head>
<title>Lunar Jetman: Routine at A8E3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A8B5.html">A8B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a8e3">Map</a></td>
<td class="next">
Next: <a href="A94B.html">A94B</a>
</td>
</tr>
</table>
<div class="description">A8E3: Game Over</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a8e3"></span>
<div class="comments">
<div class="paragraph">
Set up altering the "<img alt="game-over-0up" src="../images/font/game-over-0up.png" />" message for 1UP.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_1UP_Messaging</td>
<td class="address-2"><span id="a8e3"></span>A8E3</td>
<td class="instruction">LD A,"1"+$80</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>="1" + 80 (escape character).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a8e5"></span>
<div class="comments">
<div class="paragraph">
Print the altered messaging and pause to show it for a period of time.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_Write</td>
<td class="address-2"><span id="a8e5"></span>A8E5</td>
<td class="instruction">LD ($A95D),A</td>
<td class="comment-1" rowspan="1">Write ASCII player number to <a href="A94B.html#a94c">A95D</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8e8"></span>A8E8</td>
<td class="instruction">CALL <a href="84D8.html">CreateWindow</a></td>
<td class="comment-1" rowspan="1">Call <a href="84D8.html">CreateWindow</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a8eb"></span>
<div class="comments">
<div class="paragraph">
Handle printing "<img alt="game-over" src="../images/font/game-over.png" />" messaging.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8eb"></span>A8EB</td>
<td class="instruction">LD DE,$A94B</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="A94B.html">String_GameOver</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8ee"></span>A8EE</td>
<td class="instruction">LD HL,$7038</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=7038 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8f1"></span>A8F1</td>
<td class="instruction">CALL <a href="8A11.html">PrintStringColour</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A11.html">PrintStringColour</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8f4"></span>A8F4</td>
<td class="instruction">LD DE,$B9D2</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="B9D2.html">B9D2</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8f7"></span>A8F7</td>
<td class="instruction">CALL <a href="B9BC.html">$B9BC</a></td>
<td class="comment-1" rowspan="1">Call <a href="B9BC.html">B9BC</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a8fa"></span>
<div class="comments">
<div class="paragraph">
Set a lower delay period for the following test.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8fa"></span>A8FA</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=04 (delay loop counter).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8fc"></span>A8FC</td>
<td class="instruction">LD A,($6090)</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="6090.html">6090</a>-1A.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a8ff"></span>A8FF</td>
<td class="instruction">SUB $1A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a901"></span>A901</td>
<td class="instruction">CP $10</td>
<td class="comment-1" rowspan="2">If the lunar rover was not destroyed, jump straight to <a href="A8E3.html#a922">GameOverDelay</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a903"></span>A903</td>
<td class="instruction">JR C,<a href="A8E3.html#a922">GameOverDelay</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a905"></span>
<div class="comments">
<div class="paragraph">
Handle printing "<img alt="lunar-rover" src="../images/font/lunar-rover.png" />" messaging.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a905"></span>A905</td>
<td class="instruction">LD DE,$A95E</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="A94B.html#a95e">String_Lunar_Rover</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a908"></span>A908</td>
<td class="instruction">LD HL,$3818</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=3818 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a90b"></span>A90B</td>
<td class="instruction">CALL <a href="8A11.html">PrintStringColour</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A11.html">PrintStringColour</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a90e"></span>
<div class="comments">
<div class="paragraph">
Handle printing "<img alt="destroyed" src="../images/font/destroyed.png" />" messaging.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a90e"></span>A90E</td>
<td class="instruction">LD DE,$A979</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="A94B.html#a979">String_Destroyed</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a911"></span>A911</td>
<td class="instruction">LD HL,$4858</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=4858 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a914"></span>A914</td>
<td class="instruction">CALL <a href="8A11.html">PrintStringColour</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A11.html">PrintStringColour</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a917"></span>
<div class="comments">
<div class="paragraph">
Handle printing "<img alt="all-lost" src="../images/font/all-lost.png" />" messaging.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a917"></span>A917</td>
<td class="instruction">LD DE,$A985</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="A94B.html#a985">String_All_Lost</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a91a"></span>A91A</td>
<td class="instruction">LD HL,$5850</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=5850 (screen location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a91d"></span>A91D</td>
<td class="instruction">CALL <a href="8A11.html">PrintStringColour</a></td>
<td class="comment-1" rowspan="1">Call <a href="8A11.html">PrintStringColour</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a920"></span>
<div class="comments">
<div class="paragraph">
Provide a pause for us to reflect that the game has now ended.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a920"></span>A920</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=08 (delay loop counter).</td>
</tr>
<tr>
<td class="asm-label">GameOverDelay</td>
<td class="address-2"><span id="a922"></span>A922</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=0000.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a925"></span>
<div class="comments">
<div class="paragraph">
From <span class="register">HL</span> being set above, note that decrementing 0000 by one gives FFFF.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOverDelay_Loop</td>
<td class="address-2"><span id="a925"></span>A925</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a926"></span>A926</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="3">Jump back to <a href="A8E3.html#a925">GameOverDelay_Loop</a> until <span class="register">HL</span> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a927"></span>A927</td>
<td class="instruction">OR L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a928"></span>A928</td>
<td class="instruction">JR NZ,<a href="A8E3.html#a925">GameOverDelay_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a92a"></span>A92A</td>
<td class="instruction">DJNZ <a href="A8E3.html#a925">GameOverDelay_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease delay loop counter by one and loop back to <a href="A8E3.html#a925">GameOverDelay_Loop</a> until the counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a92c"></span>A92C</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a92d"></span>
<div class="comments">
<div class="paragraph">
Set up altering the "<img alt="game-over-0up" src="../images/font/game-over-0up.png" />" message for 2UP.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_2UP_Messaging</td>
<td class="address-2"><span id="a92d"></span>A92D</td>
<td class="instruction">LD A,"2"+$80</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>="2" + 80 (escape character).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a92f"></span>A92F</td>
<td class="instruction">JR <a href="A8E3.html#a8e5">GameOver_Write</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A8E3.html#a8e5">GameOver_Write</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a931"></span>
<div class="comments">
<div class="paragraph">
Handles checking if this is a 1UP or 2UP game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_Check_Player_1UP</td>
<td class="address-2"><span id="a931"></span>A931</td>
<td class="instruction">LD A,($5E65)</td>
<td class="comment-1" rowspan="3">If <a href="5E65.html">Flag_ActivePlayer</a> is zero, jump to <a href="A8E3.html">GameOver_1UP_Messaging</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a934"></span>A934</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a935"></span>A935</td>
<td class="instruction">JR Z,<a href="A8E3.html#a8e3">GameOver_1UP_Messaging</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a937"></span>A937</td>
<td class="instruction">JR <a href="A8E3.html#a92d">GameOver_2UP_Messaging</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A8E3.html#a92d">GameOver_2UP_Messaging</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a939"></span>
<div class="comments">
<div class="paragraph">
Handles checking if this is a 2UP or 1UP game.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_Check_Player_2UP</td>
<td class="address-2"><span id="a939"></span>A939</td>
<td class="instruction">LD A,($5E65)</td>
<td class="comment-1" rowspan="3">If <a href="5E65.html">Flag_ActivePlayer</a> is not zero, jump to <a href="A8E3.html#a945">GameOver_2UP</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a93c"></span>A93C</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a93d"></span>A93D</td>
<td class="instruction">JR NZ,<a href="A8E3.html#a945">GameOver_2UP</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a93f"></span>A93F</td>
<td class="instruction">CALL <a href="A8E3.html#a8e3">GameOver_1UP_Messaging</a></td>
<td class="comment-1" rowspan="1">Call <a href="A8E3.html">GameOver_1UP_Messaging</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a942"></span>A942</td>
<td class="instruction">JP <a href="F56E.html">NewHighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="F56E.html">NewHighScore</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="a945"></span>
<div class="comments">
<div class="paragraph">
Handle 2UP, and then check if this is a new high score.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GameOver_2UP</td>
<td class="address-2"><span id="a945"></span>A945</td>
<td class="instruction">CALL <a href="A8E3.html#a92d">GameOver_2UP_Messaging</a></td>
<td class="comment-1" rowspan="1">Call <a href="A8E3.html#a92d">GameOver_2UP_Messaging</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="a948"></span>A948</td>
<td class="instruction">JP <a href="F56E.html">NewHighScore</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="F56E.html">NewHighScore</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
View the equivalent code in; <ul class="">
<li><a href="/ultimate/aticatac/asm/8C35.html">Atic Atac</a></li>
<li><a href="/ultimate/cookie/asm/6BE0.html">Cookie</a></li>
</ul>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A8B5.html">A8B5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#a8e3">Map</a></td>
<td class="next">
Next: <a href="A94B.html">A94B</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Ultimate Play the Game &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/ultimate/tree/main/sources/lunarjetman/">Source code</a>.</div>
<div><a href="../dec/asm/43235.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>